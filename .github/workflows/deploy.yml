name: Deploy app with terraform

on:
    push: 
        branches: ['main']

jobs:
    terraform:
        runs-on: ubuntu-latest

        steps: 
            - name: checkout code
              uses: actions/checkout@v3
            
            - name: setup terraform
              uses: hashicorp/setup-terraform@v2

            - name: terraform init
              run: terraform -chdir=terraform init

            - name: terraform plan
              run: terraform -chdir=terraform plan

            - name: terraform apply
              run: terraform -chdir=terraform apply -auto-approve
              env:
                AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
                AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}